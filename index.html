<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Find your path to #Fitter #Stronger #Better | COACH CHRIS</title>
    
    <!-- --- SOCIAL SHARING METADATA --- -->
    <meta property="og:title" content="Find your path to #Fitter #Stronger #Better">
    <meta property="og:description" content="Take our short quiz to determine which service is best suited to help you achieve your goals">
    <meta property="og:image" content="https://placehold.co/1200x630/22c55e/000?text=COACH+CHRIS+Fitness+Assessment">
    <meta property="og:url" content="YOUR_APP_URL_HERE">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="Find your path to #Fitter #Stronger #Better">
    <meta name="twitter:description" content="Take our short quiz to determine which service is best suited to help you achieve your goals">
    <meta name="twitter:image" content="https://placehold.co/1200x630/22c55e/000?text=COACH+CHRIS+Fitness+Assessment">

    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap');

        /* --- BACKGROUND & GLASSMORPHISM CORE --- */
        body {
            font-family: 'Inter', sans-serif;
            background: radial-gradient(circle at 20% 20%, #1a1a1a 0%, #000 100%);
            color: #fff;
            min-height: 100vh;
            overflow-x: hidden;
            position: relative;
        }

        body::before, body::after {
            content: "";
            position: fixed;
            width: 40vw;
            height: 40vw;
            border-radius: 50%;
            background: rgba(34, 197, 94, 0.15);
            filter: blur(100px);
            z-index: -1;
            animation: move 20s infinite alternate;
        }
        body::after {
            background: rgba(34, 197, 94, 0.1);
            right: -10%;
            top: 20%;
            animation-delay: -5s;
        }
        @keyframes move {
            from { transform: translate(-10%, -10%); }
            to { transform: translate(10%, 10%); }
        }

        .glass-panel {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(16px);
            -webkit-backdrop-filter: blur(16px);
            border: 1px solid rgba(255, 255, 255, 0.125);
            box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.37);
        }

        #initial-loader {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background-color: #000;
            z-index: 9999;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            transition: opacity 0.5s ease-out;
        }

        .cycling-text {
            font-family: monospace;
            color: #22c55e;
            font-size: 0.75rem;
            letter-spacing: 0.1em;
            text-transform: uppercase;
            margin-top: 1rem;
            min-height: 1.2em;
        }

        .quiz-container {
            max-width: 650px;
            min-height: 550px;
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }

        .option-button {
            background: rgba(255, 255, 255, 0.03);
            border: 1px solid rgba(255, 255, 255, 0.1);
            color: #fff;
            font-weight: 500;
            transition: all 0.2s ease;
            position: relative;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .option-button:hover:not(.selected) {
            background: rgba(255, 255, 255, 0.08);
            border-color: rgba(34, 197, 94, 0.5);
            transform: translateX(4px);
        }

        .selected {
            background: rgba(34, 197, 94, 0.2) !important;
            border-color: #22c55e !important;
            color: #fff !important;
            box-shadow: 0 0 20px rgba(34, 197, 94, 0.2);
        }

        .check-icon {
            opacity: 0;
            transform: scale(0.5);
            transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            color: #22c55e;
        }
        .selected .check-icon {
            opacity: 1;
            transform: scale(1);
        }

        .action-button {
            background: #22c55e;
            color: #000;
            font-weight: 800;
            text-transform: uppercase;
            transition: all 0.2s;
            box-shadow: 0 4px 15px rgba(34, 197, 94, 0.4);
        }
        
        .action-button:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(34, 197, 94, 0.6);
            filter: brightness(1.1);
        }
        
        .action-button:disabled {
            background: rgba(255, 255, 255, 0.1);
            color: rgba(255, 255, 255, 0.3);
            box-shadow: none;
            cursor: not-allowed;
        }
        
        .secondary-button {
            background: rgba(255, 255, 255, 0.05);
            color: #fff;
            border: 1px solid rgba(255, 255, 255, 0.2);
            font-weight: 600;
            transition: all 0.2s;
        }
        .secondary-button:hover {
            background: rgba(255, 255, 255, 0.1);
        }

        .whatsapp-button {
            background: #25D366;
            color: #fff;
            font-weight: 700;
            transition: all 0.2s;
            box-shadow: 0 4px 15px rgba(37, 211, 102, 0.3);
        }
        .whatsapp-button:hover {
            transform: translateY(-1px);
            filter: brightness(1.05);
            box-shadow: 0 6px 20px rgba(37, 211, 102, 0.4);
        }

        .progress-container {
            background: rgba(255, 255, 255, 0.1);
        }
        .progress-bar-fill {
            background: linear-gradient(90deg, #22c55e, #4ade80);
            box-shadow: 0 0 10px rgba(34, 197, 94, 0.5);
            transition: width 0.5s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .animate-in {
            animation: slideUpFade 0.5s ease-out forwards;
        }

        @keyframes slideUpFade {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .custom-input {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: white;
            transition: all 0.2s;
        }
        .custom-input:focus {
            outline: none;
            border-color: #22c55e;
            background: rgba(255, 255, 255, 0.1);
            box-shadow: 0 0 15px rgba(34, 197, 94, 0.3);
        }
        
        input[type="checkbox"] {
            -webkit-appearance: none;
            appearance: none;
            width: 1.25rem; height: 1.25rem;
            border: 1px solid rgba(255, 255, 255, 0.3);
            background: rgba(255, 255, 255, 0.05);
            border-radius: 4px;
            cursor: pointer;
            position: relative;
        }
        input[type="checkbox"]:checked {
            background: #22c55e;
            border-color: #22c55e;
        }
        input[type="checkbox"]:checked::after {
            content: '✓';
            position: absolute;
            color: black;
            font-weight: bold;
            font-size: 0.8rem;
            top: 50%; left: 50%;
            transform: translate(-50%, -50%);
        }
        
        .clean-spinner {
            width: 50px; height: 50px;
            border: 3px solid rgba(255,255,255,0.1);
            border-top: 3px solid #22c55e;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin { 100% { transform: rotate(360deg); } }

        .result-card {
            background: rgba(255, 255, 255, 0.03);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .section-header {
            border-left: 2px solid #22c55e;
            padding-left: 1rem;
            margin-bottom: 2rem;
        }

        html {
            scroll-behavior: smooth;
        }

        .summary-tag {
            background: rgba(255, 255, 255, 0.03);
            border: 1px solid rgba(255, 255, 255, 0.08);
            border-radius: 12px;
            padding: 10px;
        }
    </style>
</head>
<body class="flex flex-col items-center justify-center p-4 sm:p-6">

    <!-- SPLASH SCREEN LOADER -->
    <div id="initial-loader">
        <div class="loader-content flex flex-col items-center px-6">
            <h1 class="text-4xl font-black text-white uppercase tracking-tighter italic text-center">DIGITAL CONSULTATION</h1>
            <div id="loader-pulse-text" class="text-green-500 font-bold text-xl uppercase tracking-widest mt-2">Loading...</div>
            <div id="loader-sub-text" class="cycling-text">Initializing assessment...</div>
        </div>
    </div>

    <!-- Main Quiz Container -->
    <div id="quiz-app" class="quiz-container glass-panel w-full rounded-3xl p-6 md:p-10 relative overflow-hidden">
        
        <div class="absolute top-0 left-0 w-full h-1.5 bg-green-500 shadow-[0_0_15px_rgba(34,197,94,0.8)]"></div>

        <!-- BRANDING BLOCK -->
        <div id="branding-block" class="mb-8 animate-in">
            <h1 class="text-3xl sm:text-4xl font-black text-white uppercase tracking-tighter leading-none">
                COACH CHRIS
            </h1>
            <div class="flex flex-wrap gap-x-4 gap-y-1 mt-2">
                <p class="text-xs font-bold uppercase text-neutral-400 tracking-widest">CIRCULAR ROOTS COACHING</p>
                <p class="text-xs font-bold uppercase text-green-500 tracking-widest">TRAIN UNCNVNTNL</p>
            </div>
        </div>

        <h2 id="main-title" class="text-2xl sm:text-3xl font-black text-white mb-6 uppercase italic tracking-tight leading-tight">
            FIND YOUR PATH TO BECOMING 
            <span class="text-green-500">#FITTER</span> 
            <span class="text-green-500">#STRONGER</span> 
            <span class="text-green-500">#BETTER</span>
        </h2>
        
        <!-- Progress Bar -->
        <div id="progress-anchor" class="mb-10">
            <div id="progress-header" class="flex items-center justify-between mb-2">
                <p id="progress-text-label" class="text-[10px] font-black uppercase tracking-[0.2em] text-neutral-400">
                    GETTING STARTED
                </p>
                <p id="progress-percent" class="text-[10px] font-black text-green-500 tracking-widest">
                    0%
                </p>
            </div>
            <div class="progress-container h-1.5 w-full rounded-full overflow-hidden">
                <div id="progress-bar-fill" class="progress-bar-fill h-full" style="width: 0%;"></div>
            </div>
        </div>

        <!-- Dynamic Content Area -->
        <div id="content-area">
            <!-- WELCOME SCREEN IS NOW THE INITIAL STATE -->
            <div class="animate-in space-y-6">
                <div class="space-y-4">
                    <p class="text-neutral-300 text-lg leading-relaxed">
                        Ready to cut through the noise? This <strong class="text-white italic">Digital Consultation</strong> is your first step toward a high-performance lifestyle.
                    </p>
                    <p class="text-neutral-400 text-sm leading-relaxed">
                        In less than 2 minutes, we'll analyze your current baseline, barriers, and goals to provide a personalized roadmap for the next 12 weeks.
                    </p>
                </div>
                
                <div class="bg-white/5 border border-white/10 rounded-2xl p-5 space-y-4">
                    <div class="flex items-start gap-4">
                        <div class="bg-green-500/20 p-2 rounded-lg text-green-500">
                            <svg class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>
                        </div>
                        <div>
                            <p class="text-xs font-bold text-white uppercase tracking-widest">Personalized Rationale</p>
                            <p class="text-[11px] text-neutral-500 mt-1">Direct feedback on why a specific path fits you.</p>
                        </div>
                    </div>
                    <div class="flex items-start gap-4">
                        <div class="bg-green-500/20 p-2 rounded-lg text-green-500">
                            <svg class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7h8m0 0v8m0-8l-8 8-4-4-6 6" /></svg>
                        </div>
                        <div>
                            <p class="text-xs font-bold text-white uppercase tracking-widest">90-Day Vision</p>
                            <p class="text-[11px] text-neutral-500 mt-1">A glimpse into what's possible with consistent effort.</p>
                        </div>
                    </div>
                </div>

                <button id="start-assessment-btn" class="action-button w-full py-5 rounded-2xl text-sm tracking-widest mt-4">
                    START THE ASSESSMENT
                </button>
                
                <p class="text-center text-[10px] text-neutral-500 uppercase tracking-widest">
                    No credit card required • Result via email
                </p>
            </div>
        </div>
    </div>
    
    <!-- Footer Block -->
    <div class="mt-12 w-full max-w-2xl text-center px-4">
        <p id="disclaimer" class="text-neutral-500 text-xs mb-6 leading-relaxed max-w-xl mx-auto">
            General Fitness Disclaimer: Always consult your medical professional or doctor before beginning any new fitness regime. This site provides general information for educational purposes only. You engage in physical activity at your own risk.
        </p>
        <p class="text-neutral-400 font-bold text-[10px] uppercase tracking-[0.25em]">
            © <span id="current-year">2025</span> COACH CHRIS | CIRCULAR ROOTS COACHING
        </p>
        <p class="text-green-500/50 text-sm italic font-semibold mt-2 tracking-widest">
            Fitter. Stronger. Better.
        </p>
    </div>

    <!-- Web3Forms Implementation -->
    <script src="https://web3forms.com/client/script.js" async defer></script>

    <script>
        const WEB3FORMS_ACCESS_KEY = "d24713b2-01ff-4c31-ae52-e49edd41e2c1";

        document.getElementById('current-year').textContent = new Date().getFullYear();

        window.addEventListener('load', () => {
            const loader = document.getElementById('initial-loader');
            const subText = document.getElementById('loader-sub-text');
            const cycleMessages = ["Loading questions...", "Configuring logic...", "Ready."];
            let i = 0;
            const cycleInterval = setInterval(() => {
                if (i < cycleMessages.length) { subText.textContent = cycleMessages[i++]; }
                else { clearInterval(cycleInterval); }
            }, 500);
            setTimeout(() => {
                loader.style.opacity = '0';
                setTimeout(() => { loader.style.display = 'none'; }, 500);
            }, 1800);
        });

        function markdownToHtml(text) {
            if (!text) return "";
            return text.replace(/\*\*(.*?)\*\*/g, '<strong class="text-white">$1</strong>')
                       .replace(/\*(.*?)\*/g, '<em class="text-neutral-300 font-medium">$1</em>');
        }

        const quizData = [
            // PART 1: IDENTITY & BARRIERS
            { 
                id: 1, 
                section: "Part 1: Your Baseline", 
                question: "How would you describe your current training experience?", 
                key: "experience", 
                summaryLabel: "Experience", 
                options: [
                    { text: "I am brand new to structured training", short: "Beginner", score: 5, expId: 'BEGINNER' }, 
                    { text: "I have some experience but lost my way", short: "Returning", score: 15, expId: 'RETURNING' }, 
                    { text: "I am an experienced trainee looking for an edge", short: "Experienced", score: 30, expId: 'EXPERIENCED' }
                ] 
            },
            { 
                id: 2, 
                question: "What is your biggest barrier to success right now?", 
                key: "barrier", 
                summaryLabel: "Main Barrier", 
                options: [
                    { text: "I don't have a plan that fits my goals", short: "Lack of Structure", score: 5 }, 
                    { text: "I struggle with follow-through and need accountability", short: "Accountability", score: 20 }, 
                    { text: "My diet is my biggest weakness (need a strategy)", short: "Nutrition Strategy", score: 30 }, 
                    { text: "Staying motivated and finding the time to train", short: "Time & Motivation", score: 10 }
                ] 
            },
            { 
                id: 3, 
                question: "What is your #1 primary fitness goal right now?", 
                key: "primaryGoal", 
                summaryLabel: "Primary Goal", 
                options: [
                    { text: "Shedding fat and transforming my physique", short: "Fat Loss & Physique", score: 30 }, 
                    { text: "Getting strong and building solid muscle", short: "Strength & Muscle", score: 20 }, 
                    { text: "Boosting energy and improving my fitness/stamina", short: "Energy & Stamina", score: 10 }, 
                    { text: "Feeling generally healthier and more consistent", short: "Health & Consistency", score: 5 }
                ] 
            },
            
            // PART 2: COMMITMENT & READINESS
            { 
                id: 4, 
                section: "Part 2: Commitment", 
                question: "How many days per week can you realistically commit?", 
                key: "commitment", 
                summaryLabel: "Commitment", 
                options: [
                    { text: "I'm ready for 5+ sessions per week (high commitment)", short: "5+ Days / Week", score: 30 }, 
                    { text: "I can commit 3-4 days a week easily", short: "3-4 Days / Week", score: 20 }, 
                    { text: "1-2 days a week is realistic for me right now", short: "1-2 Days / Week", score: 10 }, 
                    { text: "I need help finding consistency/just starting", short: "Seeking Consistency", score: 5 }
                ] 
            },
            { 
                id: 5, 
                question: "What level of support do you need to stay on track?", 
                key: "support", 
                options: [
                    { text: "I need a great plan and I'll handle the rest", score: 5 }, 
                    { text: "I need weekly guidance and access to a coach", score: 20 }, 
                    { text: "Maximum accountability, check-ins, and a custom plan", score: 30 }, 
                    { text: "I learn best in a supportive group environment", score: 10 }
                ] 
            },
            { 
                id: 6, 
                question: "Do you have any injuries or medical considerations?", 
                key: "medical", 
                summaryLabel: "Medical/Injuries", 
                options: [
                    { text: "Yes, I have current injuries requiring specialized training", short: "Specialized Care", score: 100 }, 
                    { text: "I have minor aches but nothing that stops me from training", short: "Minor Aches", score: 20 }, 
                    { text: "No, I am generally fit and injury-free", short: "Injury Free", score: 10 }, 
                    { text: "I'm not sure about my physical limitations yet", short: "Uncertain", score: 5 }
                ] 
            },

            // PART 3: LIFESTYLE
            { 
                id: 7, 
                section: "Part 3: Lifestyle Strategy", 
                question: "How would you describe your nutritional discipline?", 
                key: "nutrition", 
                options: [
                    { text: "I track macros/calories and just need refinement", altText: "I am focused on high-level performance fuel", score: 30 }, 
                    { text: "I eat generally healthy but focus on consistency", altText: "I aim for balanced meals but want more structure", score: 20 }, 
                    { text: "My eating is inconsistent; I need a full overhaul", altText: "I struggle with basic nutrition habits", score: 10 }, 
                    { text: "I haven't focused on nutrition yet", altText: "I'm just starting to look at my diet", score: 5 }
                ] 
            },
            { 
                id: 8, 
                question: "What has been your experience with following a structured plan in the past?", 
                key: "pastExp", 
                options: [
                    { text: "I’ve never followed a structured plan before.", score: 5, category: 'NEW' },
                    { text: "I’ve tried apps/PDFs but struggled to stay consistent.", score: 15, category: 'FRICTION' },
                    { text: "I’ve worked with a coach before and valued the relationship.", score: 30, category: 'COACHED' },
                    { text: "I’m currently training but feel I’ve hit a plateau.", score: 20, category: 'PLATEAU' }
                ] 
            },
            { 
                id: 9, 
                question: "Where do you primarily workout?", 
                key: "location", 
                options: [
                    { text: "A fully equipped gym/fitness center", score: 30 }, 
                    { text: "At home with minimal equipment", score: 10 }, 
                    { text: "Outdoors or using functional bodyweight training", score: 20 }, 
                    { text: "It varies (I travel or shift locations often)", score: 5 }
                ] 
            },

            // PART 4: BUDGET & MISSION
            { 
                id: 10, 
                section: "Part 4: Final Profiling", 
                question: "What level of partnership are you seeking for your investment?", 
                key: "budget", 
                summaryLabel: "Partnership Level", 
                options: [
                    { text: "Total Partnership: I need a coach to manage every detail for me", short: "Total Partnership", score: 30, budgetId: 'PREMIUM' }, 
                    { text: "Collaborative: I want a plan and regular coach guidance", short: "Collaborative", score: 20, budgetId: 'MID' }, 
                    { text: "Independent: I want the professional tools to do it myself", short: "Independent", score: 10, budgetId: 'ENTRY' }, 
                    { text: "Show me what fits my needs and goals first", short: "Undecided", score: 25, budgetId: 'FLEX' }
                ] 
            },
            { 
                id: 11, 
                question: "If you hit your goal 3 months from now, what changes most for you?", 
                key: "theWhy", 
                summaryLabel: "Your 'Why'", 
                options: [
                    { text: "My self-confidence and how I feel in my own skin", short: "Self-Confidence", score: 25, whyId: 'CONFIDENCE' }, 
                    { text: "My energy levels for my kids and family", short: "Family Energy", score: 20, whyId: 'FAMILY' }, 
                    { text: "My health longevity and long-term vitality", short: "Health Longevity", score: 30, whyId: 'HEALTH' }, 
                    { text: "My physical performance and absolute strength", short: "Peak Performance", score: 5, whyId: 'PERFORMANCE' }
                ] 
            },
            { 
                id: 12, 
                question: "How crucial is guidance on daily habits and stress management?", 
                key: "lifestyle", 
                options: [
                    { text: "Essential (sleep and stress management are priorities)", score: 30 }, 
                    { text: "Important (I want it included in check-ins)", score: 20 }, 
                    { text: "Not crucial (I only need the workout programming)", score: 10 }, 
                    { text: "I am already highly disciplined in these areas", score: 5 }
                ] 
            }
        ];

        const phaseTransitions = [
            { triggerIndex: 3, title: "Vision & Goals", message: "Thanks for that context. Now, let’s define exactly what we are aiming for over the next 12 weeks." },
            { triggerIndex: 6, title: "History & Habits", message: "Understood. Now, let's look at your training history and physical readiness to ensure we build a safe path." },
            { triggerIndex: 9, title: "The Finish Line", message: "Almost there. I just need to understand your investment level and your 'Why' to tailor the final recommendation." }
        ];

        const TIER_1_TITLE = "1-1 ONLINE COACHING";
        const TIER_2_TITLE = "FITTER STRONGER BETTER SUBSCRIPTION";
        const TIER_3_TITLE = "ONLINE PROGRAM LIBRARY";
        const FOUNDATIONS_TITLE = "14-DAY FUNDAMENTALS & 6-WEEK FOUNDATIONS";
        
        function getProgramDetailsByTitle(title) {
            if (title.includes(TIER_1_TITLE)) {
                return {
                    title: TIER_1_TITLE,
                    description: "Your goals require maximum accountability and highly specific programming.",
                    briefOverview: "Exclusive 1-on-1 coaching offering fully customized training and nutrition programming built specifically for you.", 
                    accentColor: "text-green-400",
                    ctaLink: "https://coachchriscrc.github.io/oc-lp",
                    requiresCall: true,
                    priceId: 'PREMIUM'
                };
            } else if (title.includes(FOUNDATIONS_TITLE)) {
                return {
                    title: FOUNDATIONS_TITLE,
                    description: "You need a clear starting line.",
                    briefOverview: "Begin with our **Free 14-Day Fundamentals** trial to master the basics. This leads directly into our **6-Week Foundations Program (£99)**.",
                    accentColor: "text-orange-400",
                    ctaLink: "https://coachchriscrc.github.io/14dayfundamentals-lp",
                    requiresCall: false,
                    priceId: 'ENTRY'
                };
            } else if (title.includes(TIER_2_TITLE)) {
                return {
                    title: TIER_2_TITLE,
                    description: "You have clear goals and a moderate level of commitment.",
                    briefOverview: "Access our Flagship Hybrid program (Strength, Endurance & Conditioning) via our dedicated app.", 
                    accentColor: "text-blue-400",
                    ctaLink: "https://coachchriscrc.github.io/fsb-lp",
                    requiresCall: true,
                    priceId: 'MID'
                };
            } else {
                return {
                    title: TIER_3_TITLE,
                    description: "You are seeking expert-designed, foundational guidance.",
                    briefOverview: "Gain self-guided access to a library of diverse programs, including strength cycles, conditioning blocks, and WOD packs.", 
                    accentColor: "text-neutral-300",
                    ctaLink: "https://coachchriscrc.github.io/programs-lp",
                    requiresCall: false,
                    priceId: 'ENTRY'
                };
            }
        }
        
        function getRecommendation(score, answers) {
            const budgetId = answers.find(a => a.key === 'budget')?.budgetId || 'FLEX';
            const expId = answers.find(a => a.key === 'experience')?.expId || 'BEGINNER';
            const medical = answers.find(a => a.key === 'medical')?.answer || '';
            const supportPref = answers.find(a => a.key === 'support')?.answer || '';
            const pastExp = answers.find(a => a.key === 'pastExp')?.category || 'NEW';
            
            if (medical.includes("specialized training")) return getProgramDetailsByTitle(TIER_1_TITLE);
            if (pastExp === 'COACHED' && (budgetId === 'PREMIUM' || budgetId === 'FLEX')) return getProgramDetailsByTitle(TIER_1_TITLE);
            if (budgetId === 'PREMIUM') return getProgramDetailsByTitle(TIER_1_TITLE); 
            
            if (expId === 'BEGINNER' || expId === 'RETURNING' || pastExp === 'NEW' || pastExp === 'FRICTION') {
                if (budgetId === 'ENTRY' && pastExp !== 'FRICTION') return getProgramDetailsByTitle(TIER_3_TITLE);
                return getProgramDetailsByTitle(FOUNDATIONS_TITLE);
            }

            const primaryGoal = answers.find(a => a.key === 'primaryGoal')?.answer || '';
            const theWhy = answers.find(a => a.key === 'theWhy')?.answer || '';
            const isHybridIntent = (primaryGoal.includes("Getting strong") || primaryGoal.includes("Boosting energy")) && theWhy.includes("longevity");

            if (isHybridIntent && (budgetId === 'ENTRY' || supportPref.includes("handle the rest"))) return getProgramDetailsByTitle(TIER_3_TITLE);

            const fsbThreshold = isHybridIntent ? 150 : 170;
            if (score >= fsbThreshold && budgetId !== 'ENTRY') return getProgramDetailsByTitle(TIER_2_TITLE);
            return getProgramDetailsByTitle(TIER_3_TITLE);
        }
        
        function getAlternativeRecommendation(primary, score, answers) {
            const budgetId = answers.find(a => a.key === 'budget')?.budgetId || 'FLEX';
            const expId = answers.find(a => a.key === 'experience')?.expId || 'BEGINNER';
            const medical = answers.find(a => a.key === 'medical')?.answer || '';

            if (medical.includes("specialized training") && primary.title.includes(TIER_1_TITLE)) {
                if (expId === 'EXPERIENCED') return { ...getProgramDetailsByTitle(TIER_2_TITLE), type: 'DOWNGRADE' };
                return { ...getProgramDetailsByTitle(FOUNDATIONS_TITLE), type: 'DOWNGRADE' };
            }
            if (primary.title.includes(TIER_1_TITLE)) {
                if (expId === 'EXPERIENCED') return { ...getProgramDetailsByTitle(TIER_2_TITLE), type: 'DOWNGRADE' };
                return { ...getProgramDetailsByTitle(FOUNDATIONS_TITLE), type: 'DOWNGRADE' };
            } 
            if (primary.title.includes(FOUNDATIONS_TITLE)) return { ...getProgramDetailsByTitle(TIER_3_TITLE), type: 'DOWNGRADE' };
            if (primary.title.includes(TIER_3_TITLE)) {
                if (expId === 'BEGINNER' || expId === 'RETURNING') return { ...getProgramDetailsByTitle(FOUNDATIONS_TITLE), type: 'UPGRADE' };
                return { ...getProgramDetailsByTitle(TIER_2_TITLE), type: 'UPGRADE' };
            }
            if (primary.priceId === 'MID') {
                if (score >= 230 || budgetId === 'FLEX') return { ...getProgramDetailsByTitle(TIER_1_TITLE), type: 'UPGRADE' };
                return { ...getProgramDetailsByTitle(TIER_3_TITLE), type: 'DOWNGRADE' };
            } 
            return { ...getProgramDetailsByTitle(TIER_2_TITLE), type: 'UPGRADE' };
        }
        
        function generatePersonalizedRationale(answers, recommendationTitle, isCleanText = false) {
            const rawGoal = answers.find(a => a.key === 'primaryGoal')?.answer || 'an ambitious fitness goal';
            const rawBarrier = answers.find(a => a.key === 'barrier')?.answer || 'a specific obstacle';
            const theWhyId = answers.find(a => a.key === 'theWhy')?.whyId || 'HEALTH';
            const medical = answers.find(a => a.key === 'medical')?.answer || '';
            const expId = answers.find(a => a.key === 'experience')?.expId || 'BEGINNER';
            const pastExp = answers.find(a => a.key === 'pastExp')?.answer || '';
            
            if (medical.includes("specialized training")) {
                let txt = `Because you reported an injury requiring specialized attention, I have prioritized the 1-1 Coaching path for you.`;
                return isCleanText ? txt : markdownToHtml(txt);
            }

            let goalPhrase = rawGoal;
            let quickWin = "";
            
            if (rawGoal.includes("Shedding fat")) { goalPhrase = "fat loss and physique transformation"; quickWin = "Prioritize protein in your first meal today."; }
            else if (rawGoal.includes("Getting strong")) { goalPhrase = "building muscle and strength"; quickWin = "Track your training volume (reps x sets) this week."; }
            else if (rawGoal.includes("Boosting energy")) { goalPhrase = "improved energy and endurance"; quickWin = "Drink 500ml of water before your morning coffee."; }
            else if (rawGoal.includes("Feeling generally healthier")) { goalPhrase = "establishing consistent habits"; quickWin = "Set a 10-minute movement timer for after lunch."; }

            let motivationPhrase = "";
            switch(theWhyId) {
                case 'CONFIDENCE': motivationPhrase = "designed to help you reclaim that confidence"; break;
                case 'FAMILY': motivationPhrase = "built to get that vital energy back for your family"; break;
                case 'HEALTH': motivationPhrase = "focused on ensuring your long-term health"; break;
                case 'PERFORMANCE': motivationPhrase = "programmed to push your physical performance"; break;
            }

            let expText = expId === 'BEGINNER' ? "Building a safe base is our first priority. " : (expId === 'RETURNING' ? "Re-establish fundamentals before pushing limits. " : "Focusing on high-level programming to bypass plateaus. ");

            let rationale = `${expText}We recognize ${goalPhrase} as your priority. Because your motivation is ${motivationPhrase}, we've selected this path to ensure you overcome your barriers. `;
            if (isCleanText) return rationale;

            let styledRationale = markdownToHtml(rationale);
            if (quickWin) styledRationale += `<br><br><span class="block bg-green-500/10 border border-green-500/20 p-3 rounded-xl mt-2 text-white font-medium italic"><span class="text-green-500 font-black uppercase not-italic text-[10px] tracking-widest block mb-1">Coach Chris' Quick Win:</span> ${quickWin}</span>`;
            return styledRationale;
        }

        function generateThreeMonthVision(answers) {
            const rawGoal = answers.find(a => a.key === 'primaryGoal')?.answer || '';
            const theWhyId = answers.find(a => a.key === 'theWhy')?.whyId || 'HEALTH';
            let vision = "Three months from now: ";
            if (rawGoal.includes("Shedding fat")) vision += "You will have completed your first successful 12-week transformation cycle.";
            else if (rawGoal.includes("Getting strong")) vision += "You'll be lifting with more confidence and intent, seeing real muscle growth.";
            else if (rawGoal.includes("Boosting energy")) vision += "Your energy levels will have stabilized without that afternoon caffeine hit.";
            else vision += "The 'friction' of starting will be gone. Training is now a non-negotiable part of your lifestyle.";
            return vision;
        }

        function generateAlternativeDescription(primaryRec, altRec, answers) {
            if (!altRec) return "";
            const medical = answers.find(a => a.key === 'medical')?.answer || '';
            if (medical.includes("specialized training")) return markdownToHtml(`If 1-1 Coaching is not feasible, the **${altRec.title}** pathway offers a structured starting point.`);
            return markdownToHtml(`Consider the **${altRec.title}** for a different level of support.`);
        }

        let currentStep = -1, totalScore = 0, selectedOption = null, userAnswers = [], clientName = "Warrior", clientEmail = "", isTransitioning = false;
        const contentArea = document.getElementById('content-area');
        const progressBarFill = document.getElementById('progress-bar-fill');
        const progressTextLabel = document.getElementById('progress-text-label'); 
        const progressPercent = document.getElementById('progress-percent'); 

        function updateProgress() {
            if (currentStep === -1) {
                progressBarFill.style.width = `0%`;
                progressPercent.textContent = `0%`;
                progressTextLabel.textContent = `GETTING STARTED`;
                return;
            }
            const total = quizData.length;
            const displayStep = currentStep === total ? total : currentStep + 1;
            const progress = (currentStep / total) * 100;
            progressBarFill.style.width = `${progress}%`;
            progressPercent.textContent = `${Math.round(progress)}%`;
            if (currentStep < total) progressTextLabel.textContent = `QUESTION ${displayStep} OF ${total}`;
            else progressTextLabel.textContent = `CONSULTATION COMPLETE`;
        }

        function scrollToTarget() {
            const anchor = document.getElementById('progress-anchor');
            if (anchor) {
                const offset = 30; 
                const elementPosition = anchor.getBoundingClientRect().top + window.pageYOffset;
                window.scrollTo({ top: elementPosition - offset, behavior: 'smooth' });
            }
        }

        function renderWelcomeScreen() {
            currentStep = -1;
            updateProgress();
            contentArea.innerHTML = `
                <div class="animate-in space-y-6">
                    <div class="space-y-4">
                        <p class="text-neutral-300 text-lg leading-relaxed">
                            Ready to cut through the noise? This <strong class="text-white italic">Digital Consultation</strong> is your first step toward a high-performance lifestyle.
                        </p>
                        <p class="text-neutral-400 text-sm leading-relaxed">
                            In less than 2 minutes, we'll analyze your current baseline, barriers, and goals to provide a personalized roadmap for the next 12 weeks.
                        </p>
                    </div>
                    
                    <div class="bg-white/5 border border-white/10 rounded-2xl p-5 space-y-4">
                        <div class="flex items-start gap-4">
                            <div class="bg-green-500/20 p-2 rounded-lg text-green-500">
                                <svg class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>
                            </div>
                            <div>
                                <p class="text-xs font-bold text-white uppercase tracking-widest">Personalized Rationale</p>
                                <p class="text-[11px] text-neutral-500 mt-1">Direct feedback on why a specific path fits you.</p>
                            </div>
                        </div>
                        <div class="flex items-start gap-4">
                            <div class="bg-green-500/20 p-2 rounded-lg text-green-500">
                                <svg class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7h8m0 0v8m0-8l-8 8-4-4-6 6" /></svg>
                            </div>
                            <div>
                                <p class="text-xs font-bold text-white uppercase tracking-widest">90-Day Vision</p>
                                <p class="text-[11px] text-neutral-500 mt-1">A glimpse into what's possible with consistent effort.</p>
                            </div>
                        </div>
                    </div>

                    <button id="start-assessment-btn" class="action-button w-full py-5 rounded-2xl text-sm tracking-widest mt-4">
                        START THE ASSESSMENT
                    </button>
                    
                    <p class="text-center text-[10px] text-neutral-500 uppercase tracking-widest">
                        No credit card required • Result via email
                    </p>
                </div>
            `;
            document.getElementById('start-assessment-btn').addEventListener('click', () => {
                currentStep = 0;
                renderQuestion();
                scrollToTarget();
            });
        }

        function renderQuestion() {
            if (currentStep < 0) { renderWelcomeScreen(); return; }
            if (currentStep >= quizData.length) { renderNameInputScreen(); return; }
            
            const stepData = quizData[currentStep];
            const prev = userAnswers.find(a => a.key === stepData.key);
            selectedOption = prev ? stepData.options.find(opt => opt.text === prev.answer) : null;
            contentArea.innerHTML = ''; 
            const nextText = currentStep === quizData.length - 1 ? 'SUBMIT' : 'CONTINUE';

            let currentExp = userAnswers.find(a => a.key === 'experience')?.expId || 'BEGINNER';
            let dynamicQuestion = (stepData.key === 'nutrition' && currentExp === 'EXPERIENCED') ? "How would you describe your nutritional discipline for performance?" : stepData.question;

            let sectionHtml = stepData.section ? `<div class="section-header animate-in"><p class="text-[10px] font-black uppercase tracking-widest text-green-500 mb-1">New Phase</p><h3 class="text-lg font-black uppercase text-white tracking-tight">${stepData.section}</h3></div>` : "";

            const div = document.createElement('div');
            div.className = 'animate-in';
            div.innerHTML = `
                ${sectionHtml}
                <h2 class="text-xl sm:text-2xl font-bold text-white leading-snug mb-8">${dynamicQuestion}</h2>
                <div id="options-container" class="space-y-3"></div>
                <div class="flex space-x-4 mt-12">
                    <button id="back-button" class="secondary-button w-1/3 p-4 text-sm uppercase tracking-widest rounded-2xl">BACK</button>
                    <button id="next-button" ${selectedOption ? '' : 'disabled'} class="action-button flex-grow p-4 text-sm uppercase tracking-widest rounded-2xl">${nextText}</button>
                </div>
            `;
            contentArea.appendChild(div);

            const container = document.getElementById('options-container');
            const nextBtn = document.getElementById('next-button');
            document.getElementById('back-button').addEventListener('click', handleBack);

            stepData.options.forEach(opt => {
                const btn = document.createElement('button');
                btn.className = 'option-button w-full text-left p-5 rounded-2xl text-base group';
                let displayText = (stepData.key === 'nutrition' && currentExp === 'EXPERIENCED' && opt.altText) ? opt.altText : opt.text;

                btn.innerHTML = `<span>${displayText}</span><svg class="check-icon h-5 w-5 shrink-0 ml-2" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M5 13l4 4L19 7" /></svg>`;
                if (selectedOption && opt.text === selectedOption.text) btn.classList.add('selected');
                btn.addEventListener('click', () => {
                    document.querySelectorAll('.option-button').forEach(b => b.classList.remove('selected'));
                    btn.classList.add('selected');
                    selectedOption = opt; nextBtn.disabled = false;
                });
                container.appendChild(btn);
            });
            nextBtn.addEventListener('click', handleNext);
            updateProgress();
        }

        function renderTransitionScreen(transition) {
            isTransitioning = true;
            contentArea.innerHTML = `
                <div class="text-center animate-in min-h-[350px] flex flex-col items-center justify-center space-y-8">
                    <div class="inline-block p-4 rounded-full border border-green-500/30 bg-green-500/10 mb-2">
                        <svg class="h-10 w-10 text-green-500" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>
                    </div>
                    <div>
                        <p class="text-[10px] font-black uppercase text-green-500 tracking-[0.3em] mb-2">Milestone Reached</p>
                        <h2 class="text-3xl font-black uppercase text-white italic tracking-tighter mb-4">${transition.title}</h2>
                        <p class="text-neutral-400 text-base max-w-sm mx-auto leading-relaxed">${transition.message}</p>
                    </div>
                    <button id="continue-milestone" class="action-button px-10 py-4 rounded-2xl text-xs tracking-widest">CONTINUE ASSESSMENT</button>
                </div>
            `;
            document.getElementById('continue-milestone').addEventListener('click', () => {
                isTransitioning = false;
                renderQuestion();
                scrollToTarget();
            });
        }
        
        function renderNameInputScreen() {
             currentStep = quizData.length; updateProgress();
             const summaryAnswers = quizData.filter(q => q.summaryLabel).map(q => {
                 const answer = userAnswers.find(a => a.key === q.key);
                 return { label: q.summaryLabel, value: answer ? (answer.short || answer.answer) : '—' };
             });

             let summaryGridHtml = '<div class="grid grid-cols-2 gap-3 mb-8">';
             summaryAnswers.forEach(ans => {
                 summaryGridHtml += `<div class="summary-tag"><p class="text-[8px] font-black uppercase text-neutral-500 tracking-widest mb-1">${ans.label}</p><p class="text-[10px] font-bold text-green-500 truncate">${ans.value}</p></div>`;
             });
             summaryGridHtml += '</div>';

             contentArea.innerHTML = `
                 <div class="text-center animate-in mb-8">
                     <div class="inline-block p-4 rounded-full border border-green-500/30 bg-green-500/10 mb-6"><svg class="h-8 w-8 text-green-500" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/></svg></div>
                     <h2 class="text-2xl sm:text-3xl font-black uppercase italic tracking-tighter text-white">Review Your Profile</h2>
                     <p class="text-xs text-neutral-400 mt-2 uppercase tracking-widest">Where should we send your results?</p>
                 </div>
                 <div class="animate-in">${summaryGridHtml}</div>
                 <div class="animate-in glass-panel p-6 rounded-3xl relative overflow-hidden border-green-500/20">
                     <form id="personalization-form" class="space-y-5">
                         <div><label class="block text-[10px] font-black uppercase text-neutral-500 tracking-widest mb-2">First Name</label><input type="text" id="client-name-input" name="name" required class="custom-input block w-full p-4 rounded-xl" placeholder="E.G. JANE"></div>
                         <div><label class="block text-[10px] font-black uppercase text-neutral-500 tracking-widest mb-2">Email Address</label><input type="email" id="client-email-input" name="email" required class="custom-input block w-full p-4 rounded-xl" placeholder="EMAIL@DOMAIN.COM"></div>
                         <div class="flex items-start py-2"><input type="checkbox" id="disclaimer-check" required class="mt-1"><label for="disclaimer-check" class="ml-3 text-xs text-neutral-400 leading-snug">I agree to the <a href="#disclaimer" class="font-bold underline text-white">fitness disclaimer</a>.</label></div>
                         <button type="submit" id="display-button" disabled class="action-button w-full py-5 rounded-2xl text-sm tracking-widest">VIEW ANALYSIS & EMAIL ME</button>
                     </form>
                 </div>
             `;
             document.getElementById('personalization-form').addEventListener('submit', handlePersonalize);
             const upd = () => {
                 const nameIn = document.getElementById('client-name-input').value.trim();
                 const emailIn = document.getElementById('client-email-input').value.trim();
                 const check = document.getElementById('disclaimer-check').checked;
                 document.getElementById('display-button').disabled = !(nameIn.length > 0 && emailIn.includes('@') && check);
             };
             document.getElementById('client-name-input').addEventListener('input', upd); 
             document.getElementById('client-email-input').addEventListener('input', upd);
             document.getElementById('disclaimer-check').addEventListener('change', upd); 
        }

        async function triggerWeb3FormsSubmission(primary, rationale, vision) {
            const formData = new FormData();
            formData.append("access_key", WEB3FORMS_ACCESS_KEY);
            formData.append("subject", `Coach Chris Assessment Results for ${clientName}`);
            formData.append("name", clientName);
            formData.append("email", clientEmail);
            formData.append("Recommended_Program", primary.title);
            formData.append("Personalized_Rationale", rationale);
            formData.append("Three_Month_Vision", vision);
            try { await fetch("https://api.web3forms.com/submit", { method: "POST", body: formData }); } catch (error) { console.error("Submission error", error); }
        }

        function renderLoadingScreen() {
             contentArea.innerHTML = `<div class="text-center animate-in min-h-[350px] flex flex-col items-center justify-center"><div class="clean-spinner mb-8"></div><p class="text-2xl font-black uppercase italic tracking-tighter text-white animate-pulse">Analyzing Answers...</p></div>`;
             const primary = getRecommendation(totalScore, userAnswers);
             const cleanRationale = generatePersonalizedRationale(userAnswers, primary.title, true);
             const vision = generateThreeMonthVision(userAnswers);
             triggerWeb3FormsSubmission(primary, cleanRationale, vision);
             setTimeout(() => { renderFinalProgramSummary(); window.scrollTo({top: 0, behavior: 'smooth'}); }, 2500);
        }

        function renderFinalProgramSummary() {
            const primary = getRecommendation(totalScore, userAnswers);
            const rationale = generatePersonalizedRationale(userAnswers, primary.title);
            const vision = generateThreeMonthVision(userAnswers);
            const client = clientName.toUpperCase();
            const whatsappLink = `https://wa.me/447925116794?text=${encodeURIComponent(`Hi Chris, it's ${clientName}! My result was ${primary.title}.`)}`;
            const showWhatsApp = primary.title.includes(TIER_1_TITLE) || primary.title.includes(TIER_2_TITLE);

            contentArea.innerHTML = `
                <div class="animate-in space-y-8">
                    <div class="text-center"><p class="text-[10px] font-black uppercase text-green-500 tracking-[0.3em] mb-2">Recommendation for ${client}</p><h1 class="text-3xl font-black uppercase text-white italic leading-tight">Your Optimal Path</h1></div>
                    <div class="result-card p-6 rounded-3xl border-green-500/20 bg-green-500/[0.02]">
                        <h2 class="text-2xl font-black uppercase ${primary.accentColor} mb-3 leading-tight">${primary.title}</h2>
                        <p class="text-neutral-300 text-sm mb-6">${primary.briefOverview}</p>
                        <div class="p-4 bg-white/5 border border-white/10 rounded-2xl mb-6"><p class="text-xs italic text-neutral-400 leading-relaxed">${rationale}</p></div>
                        <a href="${primary.ctaLink}" target="_blank" class="action-button w-full block py-5 rounded-2xl text-sm text-center no-underline tracking-widest mb-3">GET STARTED</a>
                        ${showWhatsApp ? `<a href="${whatsappLink}" target="_blank" class="whatsapp-button w-full block py-4 rounded-2xl text-xs text-center no-underline tracking-widest uppercase">CHAT WITH COACH CHRIS</a>` : ''}
                    </div>
                    <div class="p-6 rounded-3xl bg-green-500/10 border border-green-500/30">
                        <p class="text-[10px] font-black uppercase text-green-500 tracking-[0.3em] mb-4">Your 3-Month Vision</p>
                        <p class="text-sm text-white font-medium italic">"${vision}"</p>
                    </div>
                    <button id="restart-button" class="secondary-button w-full py-4 rounded-2xl text-xs uppercase">RESTART ASSESSMENT</button>
                </div>
            `;
            document.getElementById('restart-button').addEventListener('click', () => { location.reload(); });
        }

        function handleNext() {
            if (selectedOption !== null && !isTransitioning) {
                const key = quizData[currentStep].key;
                const idx = userAnswers.findIndex(a => a.key === key);
                if (idx !== -1) { totalScore -= userAnswers[idx].score; userAnswers.splice(idx, 1); } 
                userAnswers.push({ key, answer: selectedOption.text, short: selectedOption.short, score: selectedOption.score, budgetId: selectedOption.budgetId, expId: selectedOption.expId, whyId: selectedOption.whyId, category: selectedOption.category });
                totalScore += selectedOption.score; 
                currentStep++;
                const transition = phaseTransitions.find(t => t.triggerIndex === currentStep);
                if (transition) { renderTransitionScreen(transition); } else { renderQuestion(); }
                scrollToTarget();
            }
        }
        
        function handleBack() { 
            if (currentStep === 0) { renderWelcomeScreen(); return; }
            currentStep = Math.max(0, currentStep - 1); 
            isTransitioning = false; 
            renderQuestion(); 
            scrollToTarget(); 
        }
        
        function handlePersonalize(e) { 
            e.preventDefault(); 
            clientName = document.getElementById('client-name-input').value.trim().split(' ')[0]; 
            clientEmail = document.getElementById('client-email-input').value.trim();
            renderLoadingScreen(); 
            scrollToTarget(); 
        }
        
        document.addEventListener('DOMContentLoaded', () => { renderWelcomeScreen(); });
    </script>
</body>
</html>

